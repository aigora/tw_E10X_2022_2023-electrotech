#include <stdio.h>


typedef struct
{
    char tipo[20];
    float datos[23]; //porque hay dos años, es decir 24 meses
    float fecha; //luego la añado
}Energia;  //vector de estructuras (LO TENGO QUE DECLARAR EN LA FUNCION VOID)


int main()
{
    char aux0, aux1, aux2, x;
    int contador=0, i=0, j, k;
    int numerodefilas=0;
    int numerodeenergias=0;

    //Energia Energias[numerodeenergias];


    FILE *pf;

    pf = fopen("generacion_por_tecnologias_21_22_puntos.csv", "r");

    if(pf == NULL)
        {
            printf("Error al encontrar el archivo");
            return (-1);
        }
    else
    {

     while(fscanf(pf, "%c", &aux0) != EOF)
     {
         if(aux0 == '\n')
            numerodefilas++;

     }


     fclose(pf);
    }

    numerodefilas++;

    //AHORA LO ABRIMOS POR SEGUNDA VEZ


    pf = fopen("generacion_por_tecnologias_21_22_puntos.csv", "r"); //abrimos un fichero que se llama pf para almacenar los datos

    if(pf == NULL)
        {
            printf("Error al encontrar el archivo");
            return (-1);
        }
    else
    {

    for(i=0; i<=4; i++)
  {
  	fscanf(pf, "%c", &aux1);
    while(aux1 != '\n')
    {
        //printf("%c", aux1); //este printf es para comprobar que copia los caracteres
        fscanf(pf, "%c", &aux1);
    }

  }

  //AQUI TENGO QUE LEER LAS FECHAS

  //HASTA AQUI LEE LAS 5 PRIMERAS FILAS (INCLUIDO LAS FECHAS)

    numerodeenergias=numerodefilas-5; //le restamos las 5 primeras filas


    Energia Energias[numerodeenergias];



    for(i=0; i<=numerodeenergias; i++)
    {
        //fscanf(pf, "%c", &aux2); //TE COGE BIEN LA H
        //printf("%c", aux2);

        fscanf(pf, "%[^,]", &Energias[i].tipo);


        //ahora recorro toda la linea hasta el caracter \n

        /* ESTO FUNCIONA pero no guardo los datos en ninguna parte

        fscanf(pf, "%c", &aux2);

        while(aux2 != '\n')
        {
        //printf("%c", aux2); //este printf es para comprobar que copia los caracteres
        fscanf(pf, "%c", &aux2);
        }
        */

        //fscanf(pf, "%c", &aux2);

        k=0;

        char coma, comaalta1, comaalta2;



        for(x=0; x<=23; x++) //aqui recojo 24 datos
        {
            fscanf(pf, "%c %c %f %c", &coma, &comaalta1, &Energias[i].datos[k], &comaalta2);
            k++;
        }


    }


     for(i=3; i<=5; i++)
     {
         printf("La energia %s tiene una potencia de:\n", Energias[i].tipo);
         for(j=0; j<=24; j++)
         {
             printf("%f\t" , Energias[i].datos[j]);
         }


     }



        //para leer el resto de datos, simplemente recorro los datos del fichero hasta el \n

        /*

        fscanf(pf, "%c", &aux1); //ESTO ES MUY IMPORTANTE

        while(aux1 != '\n') //ESTO NO VA A FUNCIONAR PORQUE TENGO QUE LEER VARIOS Y GUARDARLOS EN UNA VARIABLE (ES DECIR TENGO QUE LEER TODO LO QUE ESTE SEPARADO ENTRE ,)
		{

			fscanf(pf, "%c", &aux1); //AQUI TE LEE LA ,
			fscanf(pf, "%c", &aux1); //aqui te lee el "
			fscanf(pf, "[^,]", &Energias[i].datos[j]); //aqui te lee el numero entero hasta llegar al " NO LO PUEDO HACER ASI
        }
        */
    //}

    fclose(pf); //Cerramos fichero
    }


    return 0;

}
